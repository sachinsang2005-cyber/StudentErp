<% layout('layout') -%>

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2 text-primary">
    <i class="bi bi-speedometer2 me-2"></i>Dashboard
  </h1>
  <div class="text-muted">
    <i class="bi bi-calendar3 me-1"></i>
    <%= new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %>
  </div>
</div>

<!-- Welcome Message -->
<div class="alert alert-info border-0 rounded-4 mb-4">
  <div class="d-flex align-items-center">
    <i class="bi bi-person-check-fill display-6 text-info me-3"></i>
    <div>
      <h4 class="alert-heading mb-1">Welcome back, <%= teacher.name %>!</h4>
      <p class="mb-0">Here's a quick overview of your school management activities.</p>
    </div>
  </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
  <div class="col-md-3 mb-3">
    <div class="card bg-primary text-white h-100 rounded-4">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <i class="bi bi-people-fill display-4 opacity-75"></i>
          <div class="ms-3">
            <h3 class="mb-0"><%= stats.totalStudents %></h3>
            <small>Total Students</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-3 mb-3">
    <div class="card bg-success text-white h-100 rounded-4">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <i class="bi bi-check-circle-fill display-4 opacity-75"></i>
          <div class="ms-3">
            <h3 class="mb-0"><%= stats.presentToday %></h3>
            <small>Present Today</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-3 mb-3">
    <div class="card bg-warning text-white h-100 rounded-4">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <i class="bi bi-x-circle-fill display-4 opacity-75"></i>
          <div class="ms-3">
            <h3 class="mb-0"><%= stats.absentToday %></h3>
            <small>Absent Today</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-3 mb-3">
    <div class="card bg-danger text-white h-100 rounded-4">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <i class="bi bi-currency-dollar display-4 opacity-75"></i>
          <div class="ms-3">
            <h3 class="mb-0"><%= stats.pendingFeesCount %></h3>
            <small>Pending Fees</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="row">
  <div class="col-md-6 mb-4">
    <div class="card h-100 border-0 shadow-sm rounded-4">
      <div class="card-header bg-white border-0 pt-4 pb-0">
        <h5 class="text-primary">
          <i class="bi bi-lightning-charge-fill me-2"></i>Quick Actions
        </h5>
      </div>
      <div class="card-body">
        <div class="d-grid gap-2">
          <a href="/attendance" class="btn btn-outline-primary">
            <i class="bi bi-calendar-check me-2"></i>Mark Today's Attendance
          </a>
          <a href="/students" class="btn btn-outline-success">
            <i class="bi bi-person-plus me-2"></i>Add New Student
          </a>
          <a href="/fees" class="btn btn-outline-warning">
            <i class="bi bi-currency-dollar me-2"></i>Manage Fees
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-6 mb-4">
    <div class="card h-100 border-0 shadow-sm rounded-4">
      <div class="card-header bg-white border-0 pt-4 pb-0">
        <h5 class="text-primary">
          <i class="bi bi-graph-up me-2"></i>System Status
        </h5>
      </div>
      <div class="card-body">
        <div class="mb-3">
          <div class="d-flex justify-content-between align-items-center mb-1">
            <small class="text-muted">Attendance Rate</small>
            <small class="text-muted">
              <% 
                const attendanceRate = stats.totalStudents > 0 
                  ? Math.round((stats.presentToday / stats.totalStudents) * 100) 
                  : 0;
              %>
              <%= attendanceRate %>%
            </small>
          </div>
          <div class="progress" style="height: 6px;">
            <div class="progress-bar bg-success" style="width: <%= attendanceRate %>%"></div>
          </div>
        </div>

        <div class="mb-3">
          <div class="d-flex justify-content-between align-items-center mb-1">
            <small class="text-muted">Fee Collection</small>
            <small class="text-muted">
              <% 
                const feeRate = (stats.paidFeesCount + stats.pendingFeesCount) > 0 
                  ? Math.round((stats.paidFeesCount / (stats.paidFeesCount + stats.pendingFeesCount)) * 100) 
                  : 0;
              %>
              <%= feeRate %>%
            </small>
          </div>
          <div class="progress" style="height: 6px;">
            <div class="progress-bar bg-warning" style="width: <%= feeRate %>%"></div>
          </div>
        </div>

        <div class="text-center mt-3">
          <small class="text-success">
            <i class="bi bi-check-circle-fill me-1"></i>All systems operational
          </small>
        </div>
      </div>
    </div>
  </div>
</div>