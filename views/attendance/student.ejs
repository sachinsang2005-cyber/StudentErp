<% layout('layout') -%>

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2 text-primary">
    <i class="bi bi-calendar-check me-2"></i>Attendance History
  </h1>
  <a href="/attendance" class="btn btn-outline-primary">
    <i class="bi bi-arrow-left me-2"></i>Back to Attendance
  </a>
</div>

<!-- Student Info Card -->
<div class="card border-0 shadow-sm rounded-4 mb-4">
  <div class="card-body">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h3 class="text-primary mb-1"><%= student.name %></h3>
        <p class="text-muted mb-0">
          <span class="badge bg-light text-dark me-2">Class: <%= student.class %></span>
          <span class="badge bg-primary">Roll No: <%= student.roll_no %></span>
        </p>
      </div>
      <div class="col-md-4 text-md-end">
        <div class="d-flex justify-content-md-end gap-2 mt-2 mt-md-0">
          <% 
            const totalDays = attendanceRecords.length;
            const presentDays = attendanceRecords.filter(record => record.status === 'Present').length;
            const attendancePercentage = totalDays > 0 ? Math.round((presentDays / totalDays) * 100) : 0;
          %>
          <div class="text-center">
            <div class="h4 text-success mb-0"><%= presentDays %></div>
            <small class="text-muted">Present</small>
          </div>
          <div class="text-center">
            <div class="h4 text-danger mb-0"><%= totalDays - presentDays %></div>
            <small class="text-muted">Absent</small>
          </div>
          <div class="text-center">
            <div class="h4 text-primary mb-0"><%= attendancePercentage %>%</div>
            <small class="text-muted">Attendance</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Attendance Records -->
<div class="card border-0 shadow-sm rounded-4">
  <div class="card-header bg-white border-0 pt-4">
    <h5 class="mb-0">Attendance Records</h5>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th class="border-0">Date</th>
            <th class="border-0">Status</th>
            <th class="border-0">Marked By</th>
            <th class="border-0">Time</th>
          </tr>
        </thead>
        <tbody>
          <% if (attendanceRecords && attendanceRecords.length > 0) { %>
            <% attendanceRecords.forEach(record => { %>
              <tr>
                <td>
                  <%= new Date(record.date).toLocaleDateString('en-US', { 
                    weekday: 'short', 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                  }) %>
                </td>
                <td>
                  <span class="badge <%= record.status === 'Present' ? 'bg-success' : 'bg-danger' %>">
                    <i class="bi <%= record.status === 'Present' ? 'bi-check-circle' : 'bi-x-circle' %> me-1"></i>
                    <%= record.status %>
                  </span>
                </td>
                <td>
                  <span class="text-muted">
                    <i class="bi bi-person me-1"></i>
                    <%= record.teachers ? record.teachers.name : 'Unknown' %>
                  </span>
                </td>
                <td>
                  <small class="text-muted">
                    <%= new Date(record.created_at).toLocaleTimeString('en-US', { 
                      hour: '2-digit', 
                      minute: '2-digit' 
                    }) %>
                  </small>
                </td>
              </tr>
            <% }); %>
          <% } else { %>
            <tr>
              <td colspan="4" class="text-center text-muted py-4">
                <i class="bi bi-calendar-x display-4 d-block mb-2"></i>
                No attendance records found for this student.
              </td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>